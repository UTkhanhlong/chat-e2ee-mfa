import { Server } from 'socket.io'; export function initChatGateway(io:Server){ io.on('connection',(socket)=>{ socket.on('join',({roomId})=>{ if(roomId) socket.join(roomId); }); socket.on('pubkey',(m)=>{ if(m?.roomId) socket.to(m.roomId).emit('pubkey',{from:socket.id,...m}); }); socket.on('cipher',(m)=>{ if(m?.roomId) io.to(m.roomId).emit('cipher',{from:socket.id,...m}); }); socket.on('chat',(msg)=>{ const room=msg?.roomId; const payload={from:socket.id,text:msg?.text||'',at:new Date().toISOString()}; room ? io.to(room).emit('chat',payload) : io.emit('chat',payload); }); }); }
